!function(){Gmaps4Rails.Openlayers={},Gmaps4Rails.Openlayers.Shared={createPoint:function(e,t){return new OpenLayers.Geometry.Point(t,e)},createLatLng:function(e,t){return new OpenLayers.LonLat(t,e).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"))},createAnchor:function(e){return null===e?null:new OpenLayers.Pixel(e[0],e[1])},createSize:function(e,t){return new OpenLayers.Size(e,t)},createLatLngBounds:function(){return new OpenLayers.Bounds}}}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function n(){this.constructor=t}for(var s in r)e.call(r,s)&&(t[s]=r[s]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};this.Gmaps4Rails.Openlayers.Map=function(e){function r(e,t){var r,n,s;this.controller=t,r=this.setConf(),this.options=this.mergeObjects(e,r),s={center:this.createLatLng(this.options.center_latitude,this.options.center_longitude),zoom:this.options.zoom},n=this.mergeObjects(e.raw,s),this.serviceObject=new OpenLayers.Map(this.options.id,n),this.serviceObject.addLayer(new OpenLayers.Layer.OSM)}return t(r,e),r.include(Gmaps4Rails.Interfaces.Map),r.include(Gmaps4Rails.Map),r.include(Gmaps4Rails.Openlayers.Shared),r.include(Gmaps4Rails.Configuration),r.prototype.CONF={disableDefaultUI:!1,disableDoubleClickZoom:!1,type:"ROADMAP",mapTypeControl:null},r.prototype.extendBoundsWithMarker=function(e){return this.boundsObject.extend(this.createLatLng(e.lat,e.lng))},r.prototype.extendBoundsWithPolyline=function(){},r.prototype.extendBoundsWithPolygon=function(){},r.prototype.extendBoundsWithCircle=function(){},r.prototype.extendBound=function(){},r.prototype.fitBounds=function(){return this.serviceObject.zoomToExtent(this.boundsObject,!0)},r.prototype.adaptToBounds=function(){return this.fitBounds()},r.prototype.centerMapOnUser=function(e){return this.serviceObject.setCenter(e)},r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function n(){this.constructor=t}for(var s in r)e.call(r,s)&&(t[s]=r[s]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};this.Gmaps4Rails.Openlayers.Marker=function(e){function r(e,t){this.controller=t,this.controller._createMarkersLayer(),this._createMarkerStyle(e),this._isBasicMarker(e)?this._styleForBasicMarker(e):this._styleForCustomMarker(e),this.serviceObject=new OpenLayers.Feature.Vector(this.createPoint(e.lat,e.lng),null,this.style_mark),this.serviceObject.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),this.controller.markersLayer.addFeatures([this.serviceObject])}return t(r,e),r.include(Gmaps4Rails.Interfaces.Marker),r.include(Gmaps4Rails.Openlayers.Shared),r.include(Gmaps4Rails.Marker.Instance),r.extend(Gmaps4Rails.Marker.Class),r.extend(Gmaps4Rails.Configuration),r.prototype.createInfoWindow=function(){return null!=this.description?this.serviceObject.infoWindow=this.description:void 0},r.prototype.isVisible=function(){return!0},r.prototype._isBasicMarker=function(e){return null==e.marker_picture},r.prototype._createMarkerStyle=function(e){return this.style_mark=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),this.style_mark.fillOpacity=1,this.style_mark.graphicTitle=e.marker_title},r.prototype._styleForBasicMarker=function(){return this.style_mark.graphicHeight=30,this.style_mark.externalGraphic="http://openlayers.org/dev/img/marker-blue.png"},r.prototype._styleForCustomMarker=function(e){return this.style_mark.graphicWidth=e.marker_width,this.style_mark.graphicHeight=e.marker_height,this.style_mark.externalGraphic=e.marker_picture,null!=e.marker_anchor&&(this.style_mark.graphicXOffset=e.marker_anchor[0],this.style_mark.graphicYOffset=e.marker_anchor[1]),null!=e.shadow_picture&&(this.style_mark.backgroundGraphic=e.shadow_picture,this.style_mark.backgroundWidth=e.shadow_width,this.style_mark.backgroundHeight=e.shadow_height,null!=e.shadow_anchor)?(this.style_mark.backgroundXOffset=e.shadow_anchor[0],this.style_mark.backgroundYOffset=e.shadow_anchor[1]):void 0},r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function n(){this.constructor=t}for(var s in r)e.call(r,s)&&(t[s]=r[s]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};this.Gmaps4Rails.Openlayers.Polyline=function(e){function r(e,t){var r,n,s,o,a,i,l,c,p,u,y,h;for(this.controller=t,this.controller._createPolylinesLayer(),i=[],y=0,h=e.length;h>y;y++)n=e[y],n===e[0]&&(l=n.strokeColor||this.controller.polylines_conf.strokeColor,c=n.strokeOpacity||this.controller.polylines_conf.strokeOpacity,p=n.strokeWeight||this.controller.polylines_conf.strokeWeight,r=n.clickable||this.controller.polylines_conf.clickable,u=n.zIndex||this.controller.polylines_conf.zIndex),null!=n.lat&&null!=n.lng&&(s=new OpenLayers.Geometry.Point(n.lng,n.lat),i.push(s));o=new OpenLayers.Geometry.LineString(i),a={strokeColor:l,strokeOpacity:c,strokeWidth:p},this.serviceObject=new OpenLayers.Feature.Vector(o,null,a),this.serviceObject.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),this.controller.polylinesLayer.addFeatures([this.serviceObject])}return t(r,e),r.include(Gmaps4Rails.Interfaces.Basic),r.include(Gmaps4Rails.Openlayers.Shared),r.extend(Gmaps4Rails.Polyline.Class),r.extend(Gmaps4Rails.Configuration),r.prototype.isVisible=function(){return!0},r}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,r){function n(){this.constructor=t}for(var s in r)e.call(r,s)&&(t[s]=r[s]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};this.Gmaps4RailsOpenlayers=function(e){function r(){r.__super__.constructor.apply(this,arguments),this.markersControl=null,this.markersLayer=null,this.polylinesLayer=null}return t(r,e),r.include(Gmaps4Rails.Openlayers.Shared),r.prototype.getModule=function(){return Gmaps4Rails.Openlayers},r.prototype.createClusterer=function(e){var t,r;return r=new OpenLayers.Style(this._clustererOptions,this._clustererFunctions),t=new OpenLayers.Strategy.Cluster,this._clearMarkersLayer(),this.clusterLayer=new OpenLayers.Layer.Vector("Clusters",{strategies:[t],styleMap:new OpenLayers.StyleMap({"default":r,select:{fillColor:"#8aeeef",strokeColor:"#32a8a9"}})}),this.getMapObject().addLayer(this.clusterLayer),this.clusterLayer.addFeatures(e),this.clusterLayer},r.prototype.clearClusterer=function(){return null!=this.clusterLayer&&null!=this.getMapObject().getLayer(this.clusterLayer.id)&&this.getMapObject().removeLayer(this.markerClusterer),this.clusterLayer=null},r.prototype.clearMarkers=function(){return this._clearMarkersLayer(),this.clearClusterer(),this.markers=[]},r.prototype._createPolylinesLayer=function(){return null==this.polylinesLayer?(this.polylinesLayer=new OpenLayers.Layer.Vector("Polylines",null),this.polylinesLayer.events.register("featureselected",this.polylinesLayer,this._onFeatureSelect),this.polylinesLayer.events.register("featureunselected",this.polylinesLayer,this._onFeatureUnselect),this.polylinesControl=new OpenLayers.Control.DrawFeature(this.polylinesLayer,OpenLayers.Handler.Path),this.getMapObject().addLayer(this.polylinesLayer),this.getMapObject().addControl(this.polylinesControl)):void 0},r.prototype._createMarkersLayer=function(){return null==this.markersLayer?(this.markersLayer=new OpenLayers.Layer.Vector("Markers",null),this.getMapObject().addLayer(this.markersLayer),this.markersLayer.events.register("featureselected",this.markersLayer,this._onFeatureSelect()),this.markersLayer.events.register("featureunselected",this.markersLayer,this._onFeatureUnselect()),this.markersControl=new OpenLayers.Control.SelectFeature(this.markersLayer),this.getMapObject().addControl(this.markersControl),this.markersControl.activate()):void 0},r.prototype._clearMarkersLayer=function(){return null!=this.markersLayer&&null!=this.getMapObject().getLayer(this.markersLayer.id)&&this.getMapObject().removeLayer(this.markersLayer),this.markersLayer=null},r.prototype._onFeatureSelect=function(){var e;return e=this,function(t){var r,n;return r=t.feature,n=new OpenLayers.Popup.FramedCloud("featurePopup",r.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(300,200),r.infoWindow,null,!0,e._onPopupClose(e,r)),r.popup=n,n.feature=r,e.getMapObject().addPopup(n)}},r.prototype._onFeatureUnselect=function(){var e;return e=this,function(t){var r;return r=t.feature,null!=r.popup?(e.getMapObject().removePopup(r.popup),r.popup.destroy(),r.popup=null):void 0}},r.prototype._onPopupClose=function(e,t){return function(){return e.markersControl.unselect(t)}},r.prototype._clustererFunctions={context:{width:function(e){var t;return null!=(t=e.cluster)?t:{2:1}},radius:function(e){var t;return t=2,e.cluster&&(t=e.cluster.length+10),t},label:function(e){return e.cluster?e.cluster.length:""}}},r.prototype._clustererOptions={pointRadius:"${radius}",fillColor:"#ffcc66",fillOpacity:.8,strokeColor:"#cc6633",strokeWidth:"${width}",label:"${label}"},r}(Gmaps4Rails.BaseController)}.call(this),function(){}.call(this);